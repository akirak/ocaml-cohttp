<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Server (cohttp-eio.Cohttp_eio.Server)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">cohttp-eio</a> &#x00BB; <a href="../index.html">Cohttp_eio</a> &#x00BB; Server</nav><header class="odoc-preamble"><h1>Module <code><span>Cohttp_eio.Server</span></code></h1><p><code>Server</code> is a HTTP 1.1 server.</p></header><nav class="odoc-toc"><ul><li><a href="#request-body">Request Body</a></li><li><a href="#response">Response</a></li><li><a href="#run-server">Run Server</a></li><li><a href="#basic-handlers">Basic Handlers</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-request"><a href="#type-request" class="anchor"></a><code><span><span class="keyword">type</span> request</span><span> = <a href="../../../http/Http/Request/index.html#type-t">Http.Request.t</a> * <span class="xref-unresolved">Eio</span>.Buf_read.t * <span class="xref-unresolved">Eio</span>.Net.Sockaddr.stream</span></code></div><div class="spec-doc"><p>The request headers, a reader for the socket, and the address of the client. To read the request body, use <a href="#val-read_fixed"><code>read_fixed</code></a> or <a href="#val-read_chunked"><code>read_chunked</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-response"><a href="#type-response" class="anchor"></a><code><span><span class="keyword">type</span> response</span><span> = <a href="../../../http/Http/Response/index.html#type-t">Http.Response.t</a> * <a href="../Body/index.html#type-t">Body.t</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-handler"><a href="#type-handler" class="anchor"></a><code><span><span class="keyword">type</span> handler</span><span> = <span><a href="#type-request">request</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-response">response</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-env"><a href="#type-env" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a env</span></span><span> =
  <span>&lt; domain_mgr : <span class="xref-unresolved">Eio</span>.Domain_manager.t
  ; net : <span class="xref-unresolved">Eio</span>.Net.t
  ; clock : <span class="xref-unresolved">Eio</span>.Time.clock.. &gt;</span> <span class="keyword">as</span> 'a</span></code></div></div><h2 id="request-body"><a href="#request-body" class="anchor"></a>Request Body</h2><div class="odoc-spec"><div class="spec value anchored" id="val-read_fixed"><a href="#val-read_fixed" class="anchor"></a><code><span><span class="keyword">val</span> read_fixed : <span><a href="../../../http/Http/Request/index.html#type-t">Http.Request.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Eio</span>.Buf_read.t <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p><code>read_fixed (request, buf_read)</code> is <code>Some content</code>, where <code>content</code> is of length <code>n</code> if &quot;Content-Length&quot; header is a valid integer value <code>n</code> in <code>request</code>.</p><p><code>buf_read</code> is updated to reflect that <code>n</code> bytes was read.</p><p>If <code>&quot;Content-Length&quot;</code> header is missing or is an invalid value in <code>request</code> OR if the request http method is not one of <code>POST</code>, <code>PUT</code> or <code>PATCH</code>, then <code>None</code> is returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_chunked"><a href="#val-read_chunked" class="anchor"></a><code><span><span class="keyword">val</span> read_chunked : 
  <span><a href="../../../http/Http/Request/index.html#type-t">Http.Request.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Eio</span>.Buf_read.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Body/index.html#type-chunk">Body.chunk</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../http/Http/Header/index.html#type-t">Http.Header.t</a> option</span></span></code></div><div class="spec-doc"><p><code>read_chunked request buf_read chunk_handler</code> is <code>Some updated_headers</code> if &quot;Transfer-Encoding&quot; header value is &quot;chunked&quot; in <code>request</code> and all chunks in <code>buf_read</code> are read successfully. <code>updated_headers</code> is the updated headers as specified by the chunked encoding algorithm in https: //datatracker.ietf.org/doc/html/rfc7230#section-4.1.3.</p><p><code>buf_read</code> is updated to reflect the number of bytes read. Returns <code>None</code> if <code>Transfer-Encoding</code> header in <code>headers</code> is not specified as &quot;chunked&quot;</p></div></div><h2 id="response"><a href="#response" class="anchor"></a>Response</h2><div class="odoc-spec"><div class="spec value anchored" id="val-text_response"><a href="#val-text_response" class="anchor"></a><code><span><span class="keyword">val</span> text_response : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-response">response</a></span></code></div><div class="spec-doc"><p><code>text t s</code> returns a HTTP/1.1, 200 status response with &quot;Content-Type&quot; header set to &quot;text/plain&quot;.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-html_response"><a href="#val-html_response" class="anchor"></a><code><span><span class="keyword">val</span> html_response : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-response">response</a></span></code></div><div class="spec-doc"><p><code>html t s</code> returns a HTTP/1.1, 200 status response with header set to &quot;Content-Type: text/html&quot;.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-not_found_response"><a href="#val-not_found_response" class="anchor"></a><code><span><span class="keyword">val</span> not_found_response : <a href="#type-response">response</a></span></code></div><div class="spec-doc"><p><code>not_found t</code> returns a HTTP/1.1, 404 status response.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-internal_server_error_response"><a href="#val-internal_server_error_response" class="anchor"></a><code><span><span class="keyword">val</span> internal_server_error_response : <a href="#type-response">response</a></span></code></div><div class="spec-doc"><p><code>internal_server_error</code> returns a HTTP/1.1, 500 status response.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bad_request_response"><a href="#val-bad_request_response" class="anchor"></a><code><span><span class="keyword">val</span> bad_request_response : <a href="#type-response">response</a></span></code></div></div><h2 id="run-server"><a href="#run-server" class="anchor"></a>Run Server</h2><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span>?socket_backlog:int <span class="arrow">&#45;&gt;</span></span>
  <span>?domains:int <span class="arrow">&#45;&gt;</span></span>
  <span>port:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-env">env</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-handler">handler</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'b</span></span></code></div><div class="spec-doc"><p><code>run ~socket_backlog ~domains ~port env handler</code> runs a HTTP/1.1 server executing <code>handler</code> and listening on <code>port</code>. <code>env</code> corresponds to <code>Eio</code>.Stdenv.t.</p><p><code>socket_backlog</code> is the number of pending connections for tcp server socket. The default is <code>128</code>.</p><p><code>domains</code> is the number of OCaml 5.0 domains the server will use. The default is <code>1</code>. You may use <code>Domain</code>.recommended_domain_count to configure a multicore capable server.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connection_handler"><a href="#val-connection_handler" class="anchor"></a><code><span><span class="keyword">val</span> connection_handler : 
  <span><a href="#type-handler">handler</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Eio</span>.Time.clock <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Eio</span>.Net.stream_socket <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Eio</span>.Net.Sockaddr.stream <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>connection_handler request_handler</code> is a connection handler, suitable for passing to <code>Eio</code>.Net.accept_fork.</p></div></div><h2 id="basic-handlers"><a href="#basic-handlers" class="anchor"></a>Basic Handlers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-not_found_handler"><a href="#val-not_found_handler" class="anchor"></a><code><span><span class="keyword">val</span> not_found_handler : <a href="#type-handler">handler</a></span></code></div><div class="spec-doc"><p><code>not_found_handler</code> return HTTP 404 response.</p></div></div></div></body></html>